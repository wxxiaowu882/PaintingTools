# 绘画工作台版本管理变更规则

## 目的
规范代码修改流程，确保版本可控、变更可追溯、问题可回滚。

## 文件命名规则

### 主文件
- `Index.html`：当前工作版本（基线）

### 备份文件
- `Index_v{主版本}.{次版本}.{修订号}.html`：例如 `Index_v2.18.0.html`
- 版本号说明：
  - 主版本：重大功能变更（如 v2 → v3）
  - 次版本：功能改进（如 v2.18 → v2.19）
  - 修订号：bug修复或小调整（如 v2.18.0 → v2.18.1）

### 临时文件
- `Index_temp.html`：当前修改中的版本
- `Index_backup.html`：紧急回滚备份

## 修改流程

### 1. 准备阶段
- 确认当前基线版本（`Index.html`）
- 复制基线文件：`cp Index.html Index_temp.html`
- 所有修改在 `Index_temp.html` 上进行

### 2. 实施阶段
- 每次只做一个明确的变更
- 变更前在代码中添加注释标记变更目的
- 保持代码风格一致

### 3. 测试阶段（关键节点）
- **重要**：在浏览器中打开 `Index_temp.html` 进行测试（不要测试 `Index.html`）
- 修改者生成 `Index_temp.html` 后必须**停止并通知测试人员**
- 测试人员验证变更符合需求且不影响其他功能
- **等待测试反馈**：根据测试结果决定下一步行动

### 4. 反馈处理阶段
- **如果测试通过**：
  - 备份当前基线：`cp Index.html Index_backup.html`
  - 将临时文件设为新基线：`mv Index_temp.html Index.html`
  - 创建版本备份：`cp Index.html Index_v{新版本号}.html`
  - 更新需求文档中的版本记录

- **如果测试失败**：
  - 测试人员提供详细问题描述
  - 修改者在 `Index_temp.html` 上修复问题
  - 修复后重新通知测试（回到测试阶段）

### 5. 问题处理
- 如果修改失败：`cp Index_backup.html Index.html` 恢复
- 如果需要对比：使用 `git diff` 或文件对比工具
- 如果发现回归问题：从最近版本备份恢复

## 文档记录

### 变更记录
- 在 `需求文档.md` 中记录重要变更
- 每次版本更新时更新文档中的版本号
- 记录变更日期、修改内容、修改原因

### 规则完善
- 本规则文档可通过修改 `变更规则.md` 来完善
- 规则修改需经过讨论确认
- 规则修改后需同步更新到相关文档

## 注意事项

1. **一次一变更**：避免同时进行多个不相关的修改
2. **测试先行**：修改后必须测试，确保功能正常
3. **备份优先**：重要修改前必须备份
4. **版本明确**：每次成功变更后创建版本备份
5. **文档同步**：代码变更与文档更新保持同步
6. **最小化变更**：只修改用户明确提出的问题，不擅自优化、重构或改进不在需求范围内的代码，避免影响既有正确功能

## 协作流程示例

### 示例：修改保存逻辑
1. `cp Index.html Index_temp.html`
2. 编辑 `Index_temp.html` 中的 `downloadCanvas` 函数
3. **修改者停止并通知测试人员测试 `Index_temp.html`**
4. 测试人员在浏览器中测试 `Index_temp.html` 的保存功能
5. **测试人员反馈测试结果**
6. **如果测试通过**：
   - `cp Index.html Index_backup.html`
   - `mv Index_temp.html Index.html`
   - `cp Index.html Index_v2.19.0.html`
   - 更新 `需求文档.md` 中的版本记录
7. **如果测试失败**：
   - 测试人员提供问题描述
   - 修改者在 `Index_temp.html` 上修复问题
   - 返回步骤3重新测试

---

*规则版本：v1.0.1*
*创建日期：2026-01-21*
*最后更新：2026-01-22*
